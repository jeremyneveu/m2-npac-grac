image: condaforge/mambaforge:latest

#variables:
#  BASE_URL: "https://m2-npac-ac.pages.in2p3.fr"  # "/m2-npac-ac"

cache:
  paths:
    - .cache/pip

stages:
  - build

pages:
  stage: build
  script:
    - python -V               # Print out python version for debugging
    - mamba install -y -c conda-forge nodejs pyyaml
    - node -v
    - npm install -g mystmd
    - cp myst.yml tmp_myst.yml
    #- python remove_toc.py
    - myst build --html
    - mv _build/html/ public
    - mv tmp_myst.yml myst.yml
    - myst build --html
    - mv _build/html/ public/fr
    - sed -i 's@fr/@en/@g' myst.yml
    - myst build --html
    - mv _build/html/ public/en
    - pip install jupyterlite-core jupyterlite-xeus jupyterlab notebook ipympl ipywidgets
    - rm -rf notebooks/TP_SN.ipynb
    - jupyter lite build --XeusAddon.environment_file=jupyterlite-environment.yml --contents=notebooks --output-dir=public/lite
  artifacts:
    paths:
      - public
  only:
    - main

#docker:
#  image: docker:19.03.12
#  stage: build
#  services:
#    - docker:19.03.12-dind
#  variables:
#    IMAGE_TAG: $CI_REGISTRY_IMAGE:$CI_COMMIT_REF_SLUG
#  script:
#    - cd docker
#    - ls -la .
#    # - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
#    - docker build -t $IMAGE_TAG . --file Dockerfile-CI
#    - docker push $IMAGE_TAG
#  #rules:
#  #  - changes:
#  #      - docker/*


